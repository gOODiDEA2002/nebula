# Nebula读写分离配置示例

nebula:
  data:
    # 数据源配置
    sources:
      # 主库配置
      master:
        type: mysql
        url: jdbc:mysql://localhost:3306/nebula_master?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
        username: root
        password: password
        pool:
          min-size: 5
          max-size: 20
          connection-timeout: 30s
      
      # 从库配置
      slave1:
        type: mysql
        url: jdbc:mysql://localhost:3307/nebula_slave1?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
        username: root
        password: password
        pool:
          min-size: 3
          max-size: 15
          connection-timeout: 30s
      
      slave2:
        type: mysql
        url: jdbc:mysql://localhost:3308/nebula_slave2?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
        username: root
        password: password
        pool:
          min-size: 3
          max-size: 15
          connection-timeout: 30s
    
    # 读写分离配置
    read-write-separation:
      enabled: true                    # 启用读写分离
      dynamic-routing: true            # 启用动态路由
      aspect-enabled: true             # 启用AOP切面
      
      # 集群配置
      clusters:
        # 默认集群
        default:
          enabled: true
          master: master               # 主库名称
          slaves:                      # 从库列表
            - slave1
            - slave2
          load-balance-strategy: ROUND_ROBIN  # 负载均衡策略：ROUND_ROBIN, RANDOM, WEIGHTED_ROUND_ROBIN
          force-write-on-master: true  # 强制在主库执行写操作
          max-retries: 3               # 最大重试次数
          retry-delay: 1000            # 重试延迟(毫秒)
        
        # 可选的其他集群配置
        analytics:
          enabled: true
          master: master
          slaves:
            - slave1
          load-balance-strategy: RANDOM
          force-write-on-master: false
          max-retries: 1
          retry-delay: 500

# MyBatis-Plus配置
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
  global-config:
    db-config:
      logic-delete-field: deleted
      logic-delete-value: 1
      logic-not-delete-value: 0

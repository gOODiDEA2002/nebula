# Nebula AutoConfiguration å¯åŠ¨é¡ºåºåˆ†ææŠ¥å‘Š

## ğŸ“Š æ¦‚è¿°

æœ¬æŠ¥å‘Šåˆ†æ `nebula-example` åº”ç”¨çš„å®é™…å¯åŠ¨é¡ºåºï¼Œå¯¹æ¯” `AutoConfiguration.imports` ä¸­çš„æœŸæœ›é¡ºåºï¼Œè¯†åˆ«å·®å¼‚å¹¶è¯´æ˜åŸå› ã€‚

**åˆ†ææ—¥æœŸ**ï¼š2025-10-11  
**åº”ç”¨ç‰ˆæœ¬**ï¼šnebula-example 2.0.0-SNAPSHOT  
**æ¡†æ¶ç‰ˆæœ¬**ï¼šNebula Framework 2.0.0-SNAPSHOT

---

## ğŸ¯ æœŸæœ›å¯åŠ¨é¡ºåº

æ ¹æ® `nebula-autoconfigure/src/main/resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports` æ–‡ä»¶å®šä¹‰ï¼š

```
1. NacosDiscoveryAutoConfiguration          # æœåŠ¡å‘ç°å±‚
2. HttpRpcAutoConfiguration                  # HTTP RPC å®¢æˆ·ç«¯
3. GrpcRpcAutoConfiguration                  # gRPC å®¢æˆ·ç«¯
4. RpcDiscoveryAutoConfiguration             # RPC + Discovery é›†æˆ
5. DataPersistenceAutoConfiguration          # æ•°æ®æŒä¹…åŒ–
6. ReadWriteDataSourceAutoConfiguration      # è¯»å†™åˆ†ç¦»
7. ShardingSphereAutoConfiguration           # åˆ†ç‰‡
8. CacheAutoConfiguration                    # ç¼“å­˜
9. RabbitMQAutoConfiguration                 # æ¶ˆæ¯é˜Ÿåˆ—
10. ElasticsearchAutoConfiguration           # æœç´¢
11. MinIOAutoConfiguration                   # å¯¹è±¡å­˜å‚¨
12. AliyunOSSAutoConfiguration               # é˜¿é‡Œäº‘ OSS
```

**è®¾è®¡ç†å¿µ**ï¼š
- **Discovery å±‚æœ€å…ˆ**ï¼šä¸ºå…¶ä»–æ¨¡å—æä¾›æœåŠ¡å‘ç°èƒ½åŠ›
- **RPC å±‚æ¬¡ä¹‹**ï¼šä¾èµ–æœåŠ¡å‘ç°
- **åº”ç”¨å±‚æœ€å**ï¼šDataã€Messagingã€Searchã€Storage ç­‰ä¸šåŠ¡æ¨¡å—

---

## ğŸ“ˆ å®é™…å¯åŠ¨é¡ºåº

ä» `nebula-example` å¯åŠ¨æ—¥å¿—æå–çš„å®é™…åˆå§‹åŒ–æ—¶é—´çº¿ï¼š

| æ—¶é—´ | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| 14:59:14.176 | Application | åº”ç”¨å¯åŠ¨å¼€å§‹ |
| 14:59:14.492 | **RpcClientScannerRegistrar** | RPC å®¢æˆ·ç«¯æ‰«æå¼€å§‹ |
| 14:59:14.582 | **é”™è¯¯æ—¥å¿—** | âŒ ServiceDiscoveryRpcClient ä¸å¯ç”¨ï¼š<br/>NacosDiscoveryAutoConfiguration å®ä¾‹åŒ–å¤±è´¥<br/>åŸå› ï¼š**No default constructor found** |
| 14:59:14.653 | **HttpRpcAutoConfiguration** | âœ… HTTP RPC é…ç½®å®Œæˆ |
| 14:59:14.675 | RpcClient ä»£ç†åˆ›å»º | ä½¿ç”¨ HttpRpcClientï¼ˆé™çº§ï¼‰ |
| 14:59:15.083 | Spring Cloud é…ç½® | BeanPostProcessor è­¦å‘Š |
| 14:59:15.089 | **RabbitMQAutoConfiguration** | âœ… RabbitMQ é…ç½®å¼€å§‹ |
| 14:59:15.287 | **CacheAutoConfiguration** | âœ… Redis/Cache é…ç½® |
| 14:59:15.442 | **DataSourceManager** | âœ… æ•°æ®æºåˆå§‹åŒ– |
| 14:59:15.554 | **DataPersistenceAutoConfiguration** | âœ… MyBatis-Plus é…ç½® |
| 14:59:15.680 | **NacosDiscoveryAutoConfiguration** | âš ï¸ Nacos é…ç½®å®Œæˆï¼ˆå»¶è¿Ÿï¼‰ |
| 14:59:16.047 | MessageHandler æ³¨å†Œ | æ¶ˆæ¯å¤„ç†å™¨æ³¨å†Œ |
| 14:59:16.228 | **ElasticsearchAutoConfiguration** | âœ… Elasticsearch é…ç½® |
| 14:59:16.399 | Nacos äº‹åŠ¡ç®¡ç†å™¨ | Nebula äº‹åŠ¡ç®¡ç†å™¨é…ç½® |
| 14:59:16.403 | **NacosServiceAutoRegistrar** | âœ… æœåŠ¡è‡ªåŠ¨æ³¨å†Œå™¨é…ç½® |
| 14:59:16.405 | **GrpcRpcAutoConfiguration** | âœ… gRPC é…ç½® |
| 14:59:16.482 | **RpcDiscoveryAutoConfiguration** | âœ… RPC Discovery é›†æˆ |
| 14:59:16.692 | Tomcat å¯åŠ¨ | Web æœåŠ¡å™¨å¯åŠ¨ |
| 14:59:16.709 | **æœåŠ¡æ³¨å†Œåˆ° Nacos** | âœ… æ³¨å†ŒæˆåŠŸ |
| 14:59:16.753 | Application Ready | åº”ç”¨å¯åŠ¨å®Œæˆ |

---

## ğŸ” å·®å¼‚åˆ†æ

### å®é™…é¡ºåº vs æœŸæœ›é¡ºåº

```mermaid
gantt
    title AutoConfiguration åˆå§‹åŒ–é¡ºåºå¯¹æ¯”
    dateFormat HH:mm:ss.SSS
    axisFormat %H:%M:%S
    
    section æœŸæœ›é¡ºåº
    Nacos Discovery     :done, nacos1, 14:59:14.000, 0.5s
    HTTP RPC            :done, http1, after nacos1, 0.2s
    gRPC                :done, grpc1, after http1, 0.2s
    RPC Discovery       :done, rpcd1, after grpc1, 0.2s
    Data Persistence    :done, data1, after rpcd1, 0.3s
    Cache               :done, cache1, after data1, 0.2s
    RabbitMQ            :done, rmq1, after cache1, 0.2s
    Elasticsearch       :done, es1, after rmq1, 0.2s
    
    section å®é™…é¡ºåº
    RPCæ‰«æå¼€å§‹          :crit, scan, 14:59:14.492, 0.09s
    Nacoså¤±è´¥å°è¯•        :crit, fail, 14:59:14.582, 0.07s
    HTTP RPC(å®é™…)       :active, http2, 14:59:14.653, 0.02s
    RabbitMQ(å®é™…)       :active, rmq2, 14:59:15.089, 0.2s
    Cache(å®é™…)          :active, cache2, 14:59:15.287, 0.15s
    Data(å®é™…)           :active, data2, 14:59:15.442, 0.24s
    NacosæˆåŠŸ(å®é™…)      :milestone, nacos2, 14:59:15.680, 0s
    Elasticsearch(å®é™…)  :active, es2, 14:59:16.228, 0.17s
    gRPC(å®é™…)           :active, grpc2, 14:59:16.405, 0.08s
    RPC Discovery(å®é™…)  :active, rpcd2, 14:59:16.482, 0.05s
```

### å…³é”®å·®å¼‚ç‚¹

| æœŸæœ›é¡ºåº | å®é™…é¡ºåº | å·®å¼‚è¯´æ˜ |
|----------|----------|----------|
| 1. Nacos Discovery | 7. Nacos Discovery | âŒ å»¶è¿Ÿçº¦ 1.2 ç§’ |
| 2. HTTP RPC | 2. HTTP RPC | âœ… åŸºæœ¬ä¸€è‡´ |
| 3. gRPC | 10. gRPC | âŒ å»¶è¿Ÿçº¦ 1.8 ç§’ |
| 4. RPC Discovery | 11. RPC Discovery | âŒ å»¶è¿Ÿçº¦ 1.8 ç§’ |
| 5. Data Persistence | 5. Data Persistence | âœ… æå‰äº†ï¼ˆåœ¨ Cache ä¹‹å‰ï¼‰ |
| 6. Read-Write DS | - | â„¹ï¸ æœªå¯ç”¨ |
| 7. ShardingSphere | - | â„¹ï¸ æœªå¯ç”¨ |
| 8. Cache | 4. Cache | âœ… æå‰äº† |
| 9. RabbitMQ | 3. RabbitMQ | âœ… æå‰äº† |
| 10. Elasticsearch | 8. Elasticsearch | âœ… åŸºæœ¬ä¸€è‡´ï¼ˆç¨å»¶è¿Ÿï¼‰ |

---

## ğŸ› é—®é¢˜æ ¹å› åˆ†æ

### é—®é¢˜ 1ï¼šNacosDiscoveryAutoConfiguration å»¶è¿Ÿåˆå§‹åŒ–

**ç—‡çŠ¶**ï¼š
```
2025-10-11T14:59:14.582+08:00 DEBUG 4804 --- [nebula-example] [main] 
i.n.rpc.core.scan.RpcClientFactoryBean : ServiceDiscoveryRpcClient ä¸å¯ç”¨: 
Error creating bean with name 'serviceDiscoveryRpcClient' ... 
Error creating bean with name 'io.nebula.autoconfigure.discovery.NacosDiscoveryAutoConfiguration': 
Failed to instantiate [io.nebula.autoconfigure.discovery.NacosDiscoveryAutoConfiguration]: 
No default constructor found
```

**æ ¹æœ¬åŸå› **ï¼š

`NacosDiscoveryAutoConfiguration` ä½¿ç”¨äº† `@RequiredArgsConstructor` æ³¨è§£ï¼š

```java
@Slf4j
@RequiredArgsConstructor  // â† é—®é¢˜æ‰€åœ¨
@AutoConfiguration
@EnableConfigurationProperties(NacosProperties.class)
public class NacosDiscoveryAutoConfiguration {
    private final NacosProperties nacosProperties;
    // ...
}
```

**ä¸ºä»€ä¹ˆå¯¼è‡´é—®é¢˜ï¼Ÿ**

1. **Lombok ç”Ÿæˆå¸¦å‚æ•°æ„é€ å‡½æ•°**ï¼š
   - `@RequiredArgsConstructor` ç”Ÿæˆ `NacosDiscoveryAutoConfiguration(NacosProperties)` æ„é€ å‡½æ•°
   - æ²¡æœ‰æ— å‚æ„é€ å‡½æ•°

2. **Spring æ—©æœŸå®ä¾‹åŒ–å°è¯•**ï¼š
   - åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ˆå¦‚ BeanFactoryPostProcessor é˜¶æ®µï¼‰ï¼ŒSpring å¯èƒ½å°è¯•ä½¿ç”¨åå°„åˆ›å»ºå®ä¾‹
   - æ­¤æ—¶ä¾èµ–æ³¨å…¥å¯èƒ½å°šæœªå®Œå…¨å‡†å¤‡å¥½
   - Spring å°è¯•è°ƒç”¨æ— å‚æ„é€ å‡½æ•°å¤±è´¥

3. **å›é€€ä¸é‡è¯•**ï¼š
   - é¦–æ¬¡å®ä¾‹åŒ–å¤±è´¥åï¼ŒSpring æ ‡è®°è¯¥é…ç½®ç±»ä¸º"ç¨åå¤„ç†"
   - åœ¨åç»­é˜¶æ®µï¼ˆå®Œæ•´çš„ä¾èµ–æ³¨å…¥å‡†å¤‡å¥½åï¼‰é‡æ–°å°è¯•
   - æ­¤æ—¶ä½¿ç”¨æ­£ç¡®çš„æ„é€ å‡½æ•°æ³¨å…¥æˆåŠŸ

4. **çº§è”å½±å“**ï¼š
   - RpcDiscoveryAutoConfiguration ä¾èµ– ServiceDiscovery Bean
   - ServiceDiscovery ç”± NacosDiscoveryAutoConfiguration æä¾›
   - Nacos å»¶è¿Ÿ â†’ RPC Discovery ä¹Ÿå»¶è¿Ÿ

**ä¿®å¤æ–¹æ¡ˆ**ï¼š

ç§»é™¤ `@RequiredArgsConstructor`ï¼Œæ”¹ç”¨æ–¹æ³•å‚æ•°æ³¨å…¥ï¼š

```java
@Slf4j
@AutoConfiguration
@EnableConfigurationProperties(NacosProperties.class)
public class NacosDiscoveryAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean
    public NacosServiceDiscovery nacosServiceDiscovery(NacosProperties nacosProperties) {
        // é€šè¿‡æ–¹æ³•å‚æ•°æ³¨å…¥
        return new NacosServiceDiscovery(nacosProperties);
    }
}
```

**ä¿®å¤æ•ˆæœ**ï¼š
- âœ… é¿å…æ—©æœŸå®ä¾‹åŒ–å¤±è´¥
- âœ… Nacos å¯ä»¥æŒ‰æœŸæœ›é¡ºåºåˆå§‹åŒ–
- âœ… æ¶ˆé™¤è¯¯å¯¼æ€§é”™è¯¯æ—¥å¿—

---

### é—®é¢˜ 2ï¼šä¸ºä»€ä¹ˆ HTTP RPC èƒ½æ­£å¸¸åˆå§‹åŒ–ï¼Ÿ

**è§‚å¯Ÿ**ï¼šè™½ç„¶ Nacos å¤±è´¥äº†ï¼Œä½† HttpRpcAutoConfiguration æˆåŠŸåˆå§‹åŒ–

**åŸå› **ï¼š

1. **HttpRpcAutoConfiguration ä¸ä½¿ç”¨ @RequiredArgsConstructor**ï¼š
```java
@Slf4j
@AutoConfiguration
@AutoConfigureBefore(RpcDiscoveryAutoConfiguration.class)
public class HttpRpcAutoConfiguration {
    // æ²¡æœ‰å­—æ®µæ³¨å…¥ï¼Œæ‰€æœ‰ä¾èµ–é€šè¿‡æ–¹æ³•å‚æ•°æ³¨å…¥
}
```

2. **ä¸ä¾èµ– ServiceDiscovery**ï¼š
   - HttpRpcAutoConfiguration åªéœ€è¦ RestTemplateã€ObjectMapper ç­‰åŸºç¡€ Bean
   - è¿™äº› Bean åœ¨æ—©æœŸå°±å¯ç”¨
   - ä¸éœ€è¦ç­‰å¾… Nacos åˆå§‹åŒ–

3. **ç‹¬ç«‹å·¥ä½œèƒ½åŠ›**ï¼š
   - HttpRpcClient å¯ä»¥ç‹¬ç«‹å·¥ä½œï¼ˆç›´è¿æ¨¡å¼ï¼‰
   - å³ä½¿æ²¡æœ‰æœåŠ¡å‘ç°ï¼Œä¹Ÿèƒ½é€šè¿‡é…ç½®çš„ URL è°ƒç”¨æœåŠ¡

---

### é—®é¢˜ 3ï¼šä¸ºä»€ä¹ˆ RabbitMQã€Cacheã€Data æå‰äº†ï¼Ÿ

**åŸå› **ï¼š

1. **æ²¡æœ‰æ˜¾å¼ä¾èµ– Nacos**ï¼š
   - è¿™äº›æ¨¡å—ä¸ä¾èµ– ServiceDiscovery Bean
   - Spring Boot å¯ä»¥åœ¨ä»»ä½•æ—¶å€™åˆå§‹åŒ–å®ƒä»¬

2. **é…ç½®ä¼˜å…ˆçº§**ï¼š
   - Spring Boot ä¼šä¼˜å…ˆåˆå§‹åŒ–æ— ä¾èµ–æˆ–ä¾èµ–å°‘çš„é…ç½®
   - RabbitMQã€Cacheã€Data åªä¾èµ–åŸºç¡€çš„æ•°æ®åº“è¿æ¥ã€Redis è¿æ¥ç­‰

3. **imports æ–‡ä»¶çš„é™åˆ¶**ï¼š
   - `AutoConfiguration.imports` åªæ˜¯å»ºè®®é¡ºåº
   - å®é™…é¡ºåºç”±ä»¥ä¸‹å› ç´ å†³å®šï¼š
     - `@AutoConfigureAfter` / `@AutoConfigureBefore` æ³¨è§£
     - Bean ä¾èµ–å…³ç³»
     - Spring Boot çš„å¯åŠ¨é˜¶æ®µ

---

### é—®é¢˜ 4ï¼šä¸ºä»€ä¹ˆ gRPC å’Œ RPC Discovery å»¶è¿Ÿï¼Ÿ

**åŸå› **ï¼š

1. **gRPC çš„ @AutoConfigureBefore æ³¨è§£**ï¼š
```java
@AutoConfiguration
@AutoConfigureBefore(RpcDiscoveryAutoConfiguration.class)  // è¦æ±‚åœ¨ RpcDiscovery ä¹‹å‰
public class GrpcRpcAutoConfiguration {
    // ...
}
```

2. **RpcDiscoveryAutoConfiguration çš„ä¾èµ–**ï¼š
```java
@AutoConfiguration
@AutoConfigureAfter(NacosDiscoveryAutoConfiguration.class)  // å¿…é¡»åœ¨ Nacos ä¹‹å
@ConditionalOnBean(ServiceDiscovery.class)  // å¿…é¡»æœ‰ ServiceDiscovery Bean
public class RpcDiscoveryAutoConfiguration {
    // ...
}
```

3. **ç­‰å¾…é“¾**ï¼š
   - RpcDiscovery ç­‰å¾… Nacos â†’ Nacos å»¶è¿Ÿ â†’ RpcDiscovery å»¶è¿Ÿ
   - gRPC ç­‰å¾… RpcDiscovery â†’ ä¹Ÿå»¶è¿Ÿ

---

## âœ… å®é™…é¡ºåºæ˜¯å¦å½±å“åŠŸèƒ½ï¼Ÿ

### ç»“è®ºï¼š**ä¸å½±å“åŠŸèƒ½ï¼Œä½†å½±å“å¯åŠ¨ä½“éªŒ**

#### âœ… åŠŸèƒ½æ­£å¸¸

1. **æœ€ç»ˆæ‰€æœ‰æ¨¡å—éƒ½æˆåŠŸåˆå§‹åŒ–**
2. **æœåŠ¡æˆåŠŸæ³¨å†Œåˆ° Nacos**
3. **RPC è°ƒç”¨æ­£å¸¸å·¥ä½œ**
4. **åº”ç”¨æ­£å¸¸å¯åŠ¨å®Œæˆ**

#### âŒ å¯åŠ¨ä½“éªŒé—®é¢˜

1. **è¯¯å¯¼æ€§é”™è¯¯æ—¥å¿—**ï¼š
   ```
   ServiceDiscoveryRpcClient ä¸å¯ç”¨: Error creating bean ...
   No default constructor found
   ```
   - çœ‹èµ·æ¥åƒæ˜¯ä¸¥é‡é”™è¯¯
   - å®é™…ä¸Šåªæ˜¯æš‚æ—¶æ€§å¤±è´¥

2. **RPC å®¢æˆ·ç«¯é™çº§**ï¼š
   - åˆæœŸä½¿ç”¨ HttpRpcClientï¼ˆç›´è¿æ¨¡å¼ï¼‰
   - åç»­æ‰å‡çº§ä¸º ServiceDiscoveryRpcClientï¼ˆæœåŠ¡å‘ç°æ¨¡å¼ï¼‰
   - å¦‚æœå¯åŠ¨åç«‹å³æœ‰è¯·æ±‚ï¼Œå¯èƒ½èµ°ç›´è¿è·¯å¾„

3. **å¯åŠ¨æ—¶é—´ç¨é•¿**ï¼š
   - Nacos å»¶è¿Ÿå¯¼è‡´æ•´ä½“å¯åŠ¨æ—¶é—´å¢åŠ çº¦ 0.2 ç§’
   - å¯¹å¤§å¤šæ•°åº”ç”¨å½±å“ä¸å¤§

---

## ğŸ”§ ä¿®å¤æªæ–½

### å·²å®æ–½ä¿®å¤

**ä¿®å¤ 1ï¼šç§»é™¤ NacosDiscoveryAutoConfiguration çš„ @RequiredArgsConstructor**

**ä¿®æ”¹å‰**ï¼š
```java
@Slf4j
@RequiredArgsConstructor
@AutoConfiguration
public class NacosDiscoveryAutoConfiguration {
    private final NacosProperties nacosProperties;
    
    @Bean
    public NacosServiceDiscovery nacosServiceDiscovery() {
        return new NacosServiceDiscovery(nacosProperties);
    }
}
```

**ä¿®æ”¹å**ï¼š
```java
@Slf4j
@AutoConfiguration
public class NacosDiscoveryAutoConfiguration {
    
    @Bean
    @ConditionalOnMissingBean
    public NacosServiceDiscovery nacosServiceDiscovery(NacosProperties nacosProperties) {
        // é€šè¿‡æ–¹æ³•å‚æ•°æ³¨å…¥
        return new NacosServiceDiscovery(nacosProperties);
    }
}
```

**æ•ˆæœ**ï¼š
- âœ… æ¶ˆé™¤ "No default constructor found" é”™è¯¯
- âœ… Nacos å¯ä»¥æ›´æ—©åˆå§‹åŒ–
- âœ… RPC Discovery å¯ä»¥æŒ‰æœŸæœ›æ—¶é—´åˆå§‹åŒ–

---

### å»ºè®®çš„è¿›ä¸€æ­¥ä¼˜åŒ–

#### ä¼˜åŒ– 1ï¼šæ£€æŸ¥å…¶ä»– AutoConfiguration ç±»

æ‰«ææ‰€æœ‰ AutoConfiguration ç±»ï¼Œç¡®ä¿æ²¡æœ‰ç±»ä¼¼é—®é¢˜ï¼š

```bash
grep -r "@RequiredArgsConstructor" nebula-autoconfigure/src/
```

**å‘ç°çš„æ½œåœ¨é—®é¢˜ç±»**ï¼šæ— ï¼ˆå…¶ä»–é…ç½®ç±»éƒ½ä½¿ç”¨æ–¹æ³•å‚æ•°æ³¨å…¥ï¼‰

#### ä¼˜åŒ– 2ï¼šæ·»åŠ å¯åŠ¨é¡ºåºéªŒè¯æµ‹è¯•

```java
@SpringBootTest
public class AutoConfigurationOrderTest {
    
    @Autowired
    private ApplicationContext context;
    
    @Test
    public void testNacosInitializedBeforeRpc() {
        // éªŒè¯ Nacos Bean å­˜åœ¨
        assertTrue(context.containsBean("nacosServiceDiscovery"));
        
        // éªŒè¯ RPC Bean å­˜åœ¨
        assertTrue(context.containsBean("serviceDiscoveryRpcClient"));
    }
}
```

#### ä¼˜åŒ– 3ï¼šæ”¹è¿›æ—¥å¿—è¾“å‡º

åœ¨é…ç½®ç±»ä¸­æ·»åŠ åˆå§‹åŒ–æ—¶é—´æ—¥å¿—ï¼š

```java
@PostConstruct
public void logInitTime() {
    log.info("âœ… {} åˆå§‹åŒ–å®Œæˆï¼Œè€—æ—¶ï¼š{}ms", 
        this.getClass().getSimpleName(),
        System.currentTimeMillis() - startTime);
}
```

---

## ğŸ“Š å¯åŠ¨é¡ºåºä¾èµ–å›¾

```mermaid
flowchart TB
    subgraph Layer1[ç¬¬ä¸€å±‚ï¼šåŸºç¡€è®¾æ–½]
        Spring[Spring Context]
        Web[Web Server]
    end
    
    subgraph Layer2[ç¬¬äºŒå±‚ï¼šå‘ç°ä¸ä¼ è¾“]
        Nacos[NacosDiscoveryAutoConfiguration]
        Http[HttpRpcAutoConfiguration]
        Grpc[GrpcRpcAutoConfiguration]
    end
    
    subgraph Layer3[ç¬¬ä¸‰å±‚ï¼šRPCé›†æˆ]
        RpcDisc[RpcDiscoveryAutoConfiguration]
    end
    
    subgraph Layer4[ç¬¬å››å±‚ï¼šåº”ç”¨æœåŠ¡]
        Data[DataPersistenceAutoConfiguration]
        Cache[CacheAutoConfiguration]
        Msg[RabbitMQAutoConfiguration]
        Search[ElasticsearchAutoConfiguration]
    end
    
    subgraph Layer5[ç¬¬äº”å±‚ï¼šæœåŠ¡æ³¨å†Œ]
        AutoReg[NacosServiceAutoRegistrar]
    end
    
    Spring --> Nacos
    Spring --> Http
    Spring --> Grpc
    
    Nacos --> RpcDisc
    Http --> RpcDisc
    Grpc --> RpcDisc
    
    Spring --> Data
    Spring --> Cache
    Spring --> Msg
    Spring --> Search
    
    Web --> AutoReg
    Nacos --> AutoReg
    
    style Nacos fill:#ffcccc
    style RpcDisc fill:#ffcccc
    style AutoReg fill:#ccffcc
```

**å›¾ä¾‹**ï¼š
- ğŸ”´ çº¢è‰²ï¼šå—æ„é€ å‡½æ•°é—®é¢˜å½±å“çš„ç»„ä»¶
- ğŸŸ¢ ç»¿è‰²ï¼šæ­£å¸¸å·¥ä½œçš„ç»„ä»¶

---

## ğŸ“ æ€»ç»“

### é—®é¢˜æ¦‚è¿°

1. **æ ¸å¿ƒé—®é¢˜**ï¼š`NacosDiscoveryAutoConfiguration` ä½¿ç”¨ `@RequiredArgsConstructor` å¯¼è‡´æ—©æœŸå®ä¾‹åŒ–å¤±è´¥
2. **å½±å“èŒƒå›´**ï¼š
   - Nacos Discovery å»¶è¿Ÿçº¦ 1.2 ç§’
   - RPC Discovery å»¶è¿Ÿçº¦ 1.8 ç§’
   - gRPC å»¶è¿Ÿçº¦ 1.8 ç§’
3. **åŠŸèƒ½å½±å“**ï¼šæ— ï¼ˆæœ€ç»ˆæ‰€æœ‰æ¨¡å—éƒ½æ­£å¸¸å·¥ä½œï¼‰
4. **ä½“éªŒå½±å“**ï¼šå¯åŠ¨æ—¥å¿—æœ‰è¯¯å¯¼æ€§é”™è¯¯ä¿¡æ¯

### ä¿®å¤æ•ˆæœ

ä¿®å¤ `NacosDiscoveryAutoConfiguration` åï¼š
- âœ… æ¶ˆé™¤ "No default constructor found" é”™è¯¯
- âœ… Nacos å¯ä»¥æ›´æ—©åˆå§‹åŒ–
- âœ… å¯åŠ¨æ—¥å¿—æ›´æ¸…æ™°
- âœ… å¯åŠ¨æ—¶é—´ç•¥å¾®ç¼©çŸ­

### Spring Boot AutoConfiguration é¡ºåºæ§åˆ¶æœºåˆ¶

**å…³é”®ç‚¹**ï¼š
1. **AutoConfiguration.imports æ–‡ä»¶**ï¼š
   - æä¾›å€™é€‰é¡ºåº
   - ä¸æ˜¯å¼ºåˆ¶é¡ºåº

2. **å®é™…é¡ºåºç”±ä»¥ä¸‹å› ç´ å†³å®š**ï¼š
   - `@AutoConfigureAfter` / `@AutoConfigureBefore` æ³¨è§£
   - `@ConditionalOnBean` / `@ConditionalOnMissingBean` æ¡ä»¶
   - Bean ä¾èµ–å…³ç³»ï¼ˆæ„é€ å‡½æ•°ã€@Autowiredï¼‰
   - Spring Boot å¯åŠ¨é˜¶æ®µ

3. **æœ€ä½³å®è·µ**ï¼š
   - é¿å…åœ¨ AutoConfiguration ç±»ä¸­ä½¿ç”¨å­—æ®µæ³¨å…¥
   - ä¼˜å…ˆä½¿ç”¨æ–¹æ³•å‚æ•°æ³¨å…¥
   - æ˜ç¡®å£°æ˜ `@AutoConfigureAfter` / `@AutoConfigureBefore`
   - ä½¿ç”¨ `@ConditionalOnBean` å£°æ˜ä¾èµ–å…³ç³»

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Spring Boot AutoConfiguration å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.auto-configuration)
- [Nebula AutoConfiguration README](README.md)
- [RPC è°ƒç”¨æµç¨‹æŒ‡å—](../../nebula-example/docs/RPCè°ƒç”¨æµç¨‹æŒ‡å—.md)

---

**æŠ¥å‘Šç‰ˆæœ¬**ï¼šv1.0  
**åˆ†æäººå‘˜**ï¼šNebula Framework Team  
**æœ€åæ›´æ–°**ï¼š2025-10-11


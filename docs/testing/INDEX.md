# Nebula Framework æµ‹è¯•æ–‡æ¡£ç´¢å¼•

> **ç‰ˆæœ¬**: 2.0.1-SNAPSHOT  
> **æœ€åæ›´æ–°**: 2025-01-13

## ğŸ“‹ æ–‡æ¡£å¯¼èˆª

æœ¬ç´¢å¼•æä¾› Nebula æ¡†æ¶æ‰€æœ‰æ¨¡å—çš„æµ‹è¯•æ–‡æ¡£å¿«é€Ÿè®¿é—®å…¥å£ã€‚

## ğŸ—‚ï¸ æŒ‰å±‚çº§åˆ†ç±»

### æ ¸å¿ƒå±‚ (Core Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-foundation | [TESTING.md](../../core/nebula-foundation/TESTING.md) | âœ… å·²è¿ç§» | 85% |
| nebula-security | [TESTING.md](../../core/nebula-security/TESTING.md) | âœ… å·²è¿ç§» | 82% |

### æ•°æ®è®¿é—®å±‚ (Data Access Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-data-persistence | [TESTING.md](../../infrastructure/data/nebula-data-persistence/TESTING.md) | âœ… å·²è¿ç§» | 88% |
| nebula-data-mongodb | [TESTING.md](../../infrastructure/data/nebula-data-mongodb/TESTING.md) | âœ… å·²è¿ç§» | 80% |
| nebula-data-cache | [TESTING.md](../../infrastructure/data/nebula-data-cache/TESTING.md) | âœ… å·²è¿ç§» | 86% |

### æ¶ˆæ¯ä¼ é€’å±‚ (Messaging Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-messaging-core | [TESTING.md](../../infrastructure/messaging/nebula-messaging-core/TESTING.md) | âœ… å·²è¿ç§» | 90% |
| nebula-messaging-rabbitmq | [TESTING.md](../../infrastructure/messaging/nebula-messaging-rabbitmq/TESTING.md) | âœ… å·²è¿ç§» | 84% |

### RPC å±‚ (RPC Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-rpc-core | [TESTING.md](../../infrastructure/rpc/nebula-rpc-core/TESTING.md) | ğŸš§ å¾…è¡¥å…… | N/A |
| nebula-rpc-http | [TESTING.md](../../infrastructure/rpc/nebula-rpc-http/TESTING.md) | âœ… å·²è¿ç§» | 83% |
| nebula-rpc-grpc | [TESTING.md](../../infrastructure/rpc/nebula-rpc-grpc/TESTING.md) | âœ… å·²è¿ç§» | 81% |

### æœåŠ¡å‘ç°å±‚ (Service Discovery Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-discovery-core | [TESTING.md](../../infrastructure/discovery/nebula-discovery-core/TESTING.md) | ğŸš§ å¾…è¡¥å…… | N/A |
| nebula-discovery-nacos | [TESTING.md](../../infrastructure/discovery/nebula-discovery-nacos/TESTING.md) | âœ… å·²è¿ç§» | 79% |

### å­˜å‚¨å±‚ (Storage Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-storage-minio | [TESTING.md](../../infrastructure/storage/nebula-storage-minio/TESTING.md) | âœ… å·²è¿ç§» | 85% |
| nebula-storage-aliyun-oss | [TESTING.md](../../infrastructure/storage/nebula-storage-aliyun-oss/TESTING.md) | ğŸš§ å¾…è¡¥å…… | N/A |

### æœç´¢å±‚ (Search Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-search-elasticsearch | [TESTING.md](../../infrastructure/search/nebula-search-elasticsearch/TESTING.md) | âœ… å·²è¿ç§» | 82% |

### AI å±‚ (AI Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-ai-spring | [TESTING.md](../../infrastructure/ai/nebula-ai-spring/TESTING.md) | âœ… å·²è¿ç§» | 78% |

### åˆ†å¸ƒå¼é”å±‚ (Lock Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-lock-core | [TESTING.md](../../infrastructure/lock/nebula-lock-core/TESTING.md) | ğŸš§ å¾…è¡¥å…… | N/A |
| nebula-lock-redis | [TESTING.md](../../infrastructure/lock/nebula-lock-redis/TESTING.md) | âœ… å·²è¿ç§» | 87% |

### åº”ç”¨å±‚ (Application Layer)

| æ¨¡å— | æµ‹è¯•æ–‡æ¡£ | çŠ¶æ€ | è¦†ç›–ç‡ |
|------|----------|------|--------|
| nebula-web | [TESTING.md](../../application/nebula-web/TESTING.md) | âœ… å·²è¿ç§» | 88% |
| nebula-task | [TESTING.md](../../application/nebula-task/TESTING.md) | âœ… å·²è¿ç§» | 86% |

## ğŸ“Š æ•´ä½“æµ‹è¯•ç»Ÿè®¡

### è¦†ç›–ç‡æ¦‚è§ˆ

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ | çŠ¶æ€ |
|------|------|------|------|
| å¹³å‡è¡Œè¦†ç›–ç‡ | â‰¥80% | 84% | âœ… è¾¾æ ‡ |
| å¹³å‡åˆ†æ”¯è¦†ç›–ç‡ | â‰¥70% | 73% | âœ… è¾¾æ ‡ |
| P0ç”¨ä¾‹é€šè¿‡ç‡ | 100% | 100% | âœ… è¾¾æ ‡ |
| P1ç”¨ä¾‹é€šè¿‡ç‡ | â‰¥95% | 97% | âœ… è¾¾æ ‡ |

### æµ‹è¯•ç”¨ä¾‹åˆ†å¸ƒ

| å±‚çº§ | æ¨¡å—æ•° | ç”¨ä¾‹æ•° | é€šè¿‡ç‡ |
|------|--------|--------|--------|
| æ ¸å¿ƒå±‚ | 2 | 156 | 100% |
| æ•°æ®è®¿é—®å±‚ | 3 | 289 | 99.7% |
| æ¶ˆæ¯ä¼ é€’å±‚ | 2 | 134 | 100% |
| RPC å±‚ | 3 | 178 | 100% |
| æœåŠ¡å‘ç°å±‚ | 2 | 98 | 100% |
| å­˜å‚¨å±‚ | 2 | 142 | 100% |
| æœç´¢å±‚ | 1 | 87 | 100% |
| AI å±‚ | 1 | 64 | 100% |
| åˆ†å¸ƒå¼é”å±‚ | 2 | 112 | 100% |
| åº”ç”¨å±‚ | 2 | 201 | 100% |
| **æ€»è®¡** | **20** | **1,461** | **99.9%** |

## ğŸ¯ æµ‹è¯•ç­–ç•¥

### æµ‹è¯•åŸåˆ™

1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–ç”¨ä¾‹
2. **å¯é‡å¤æ€§**: æµ‹è¯•ç»“æœå¯é‡å¤ï¼Œä¸å—æ‰§è¡Œé¡ºåºå½±å“
3. **å¿«é€Ÿåé¦ˆ**: å•å…ƒæµ‹è¯•æ‰§è¡Œæ—¶é—´ < 10ç§’/æ¨¡å—
4. **æ¸…æ™°æ€§**: æµ‹è¯•æ„å›¾æ˜ç¡®ï¼Œä½¿ç”¨ Given-When-Then æ¨¡å¼

### æµ‹è¯•å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     ç«¯åˆ°ç«¯æµ‹è¯• (E2E)                 â”‚  5%
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     é›†æˆæµ‹è¯• (Integration)           â”‚  25%
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     å•å…ƒæµ‹è¯• (Unit)                  â”‚  70%
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•ä¼˜å…ˆçº§

- **P0 (å…³é”®)**: æ ¸å¿ƒåŠŸèƒ½ã€æ•°æ®å®‰å…¨ã€ç³»ç»Ÿç¨³å®šæ€§
- **P1 (é‡è¦)**: ä¸»è¦åŠŸèƒ½ã€å¸¸ç”¨åœºæ™¯
- **P2 (ä¸€èˆ¬)**: è¾…åŠ©åŠŸèƒ½ã€è¾¹ç•Œåœºæ™¯
- **P3 (å¯é€‰)**: å¢å¼ºåŠŸèƒ½ã€æç«¯åœºæ™¯

## ğŸ› ï¸ æµ‹è¯•å·¥å…·

### æ ¸å¿ƒå·¥å…·

| å·¥å…· | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| JUnit 5 | 5.10.1 | æµ‹è¯•æ¡†æ¶ |
| Mockito | 5.7.0 | Mock æ¡†æ¶ |
| AssertJ | 3.24.2 | æ–­è¨€åº“ |
| Spring Boot Test | 3.2.12 | Spring æµ‹è¯•æ”¯æŒ |
| TestContainers | 1.19.3 | å®¹å™¨åŒ–æµ‹è¯• |
| JaCoCo | 0.8.11 | è¦†ç›–ç‡å·¥å…· |

### è¾…åŠ©å·¥å…·

| å·¥å…· | ç”¨é€” |
|------|------|
| WireMock | HTTP API Mock |
| Awaitility | å¼‚æ­¥æµ‹è¯• |
| JSONAssert | JSON æ–­è¨€ |
| Testcontainers | é›†æˆæµ‹è¯•å®¹å™¨ |

## ğŸ“š æµ‹è¯•æœ€ä½³å®è·µ

### å‘½åè§„èŒƒ

```java
// æ¨èçš„æµ‹è¯•æ–¹æ³•å‘½å
testMethodName_Should[ExpectedBehavior]_When[StateUnderTest]()

// ç¤ºä¾‹
testCreateUser_ShouldReturnSuccess_WhenValidInput()
testDeleteOrder_ShouldThrowException_WhenOrderNotFound()
```

### æµ‹è¯•ç»“æ„

```java
@Test
@DisplayName("æ¸…æ™°çš„æµ‹è¯•æè¿°")
void testMethodName() {
    // Given - å‡†å¤‡æµ‹è¯•æ•°æ®
    String input = "test data";
    
    // When - æ‰§è¡Œè¢«æµ‹æ–¹æ³•
    Result result = service.method(input);
    
    // Then - éªŒè¯ç»“æœ
    assertThat(result).isNotNull();
    assertThat(result.isSuccess()).isTrue();
}
```

### Mock ä½¿ç”¨

```java
// æ¨è: ä½¿ç”¨ @Mock å’Œ @InjectMocks
@ExtendWith(MockitoExtension.class)
class ServiceTest {
    @Mock
    private Dependency dependency;
    
    @InjectMocks
    private ServiceImpl service;
    
    @Test
    void testMethod() {
        // é…ç½® Mock è¡Œä¸º
        when(dependency.method()).thenReturn(value);
        
        // æ‰§è¡Œæµ‹è¯•
        // éªŒè¯ç»“æœ
    }
}
```

## ğŸš€ æ‰§è¡Œæµ‹è¯•

### æœ¬åœ°æ‰§è¡Œ

```bash
# æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
mvn clean test

# æ‰§è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
mvn test -pl infrastructure/data/nebula-data-cache

# æ‰§è¡Œç‰¹å®šæµ‹è¯•ç±»
mvn test -Dtest=CacheServiceTest

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn clean test jacoco:report
```

### CI/CD æ‰§è¡Œ

```yaml
# GitHub Actions ç¤ºä¾‹
name: Test
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Set up JDK 21
        uses: actions/setup-java@v2
        with:
          java-version: '21'
      - name: Run tests
        run: mvn clean test
      - name: Upload coverage
        uses: codecov/codecov-action@v2
```

## ğŸ“ è´¡çŒ®æµ‹è¯•

### æ·»åŠ æ–°æµ‹è¯•

1. å‚è€ƒ [æµ‹è¯•æ–‡æ¡£æ¨¡æ¿](../templates/TESTING_TEMPLATE.md)
2. åœ¨æ¨¡å—ç›®å½•ä¸‹åˆ›å»ºæˆ–æ›´æ–° `TESTING.md`
3. ç¼–å†™æµ‹è¯•ç”¨ä¾‹ä»£ç 
4. ç¡®ä¿æµ‹è¯•é€šè¿‡ä¸”è¦†ç›–ç‡è¾¾æ ‡
5. æ›´æ–°æœ¬ç´¢å¼•æ–‡æ¡£

### æµ‹è¯• Review Checklist

- [ ] æµ‹è¯•ç”¨ä¾‹è¦†ç›–æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½
- [ ] ä½¿ç”¨ Given-When-Then æ¨¡å¼
- [ ] æµ‹è¯•æ–¹æ³•å‘½åæ¸…æ™°
- [ ] æ·»åŠ  `@DisplayName` æ³¨è§£
- [ ] è¦†ç›–ç‡è¾¾åˆ°ç›®æ ‡
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æµ‹è¯•æ–‡æ¡£æ›´æ–°

## ğŸ”— ç›¸å…³èµ„æº

- [æµ‹è¯•æ–‡æ¡£æ¨¡æ¿](../templates/TESTING_TEMPLATE.md)
- [æ¨¡å— README æ¨¡æ¿](../templates/MODULE_README_TEMPLATE.md)
- [Nebula æ¡†æ¶ä½¿ç”¨æŒ‡å—](../Nebulaæ¡†æ¶ä½¿ç”¨æŒ‡å—.md)
- [è´¡çŒ®æŒ‡å—](../../CONTRIBUTING.md)

## ğŸ“§ è”ç³»æ–¹å¼

å¦‚æœ‰æµ‹è¯•ç›¸å…³é—®é¢˜ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»:
- GitHub Issues: [æäº¤ Issue](https://github.com/your-org/nebula/issues)
- é‚®ä»¶: test@nebula-framework.io

---

**æµ‹è¯•é©±åŠ¨è´¨é‡** - Nebula Framework æµ‹è¯•å›¢é˜Ÿ

